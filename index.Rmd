---
title: "JSC370 Final Project"
author: "Cathy Pei"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

Welcome to Cathy Pei's JSC370 Final Project website. This project seeks to explore a series of questions: How does the vintage of a wine impact its price? What is the correlation between a wine's rated points and its price? Furthermore, how do reviewers describe the highest-rated and most expensive wines? The project will also examine the feasibility of predicting a wine's price based on descriptive words and other features. The dataset employed for this investigation was sourced from Kaggle and includes wine reviews compiled from WineEnthusiast during the week of June 15th, 2017.

Click here to download the PDF Report: [Download PDF](./final/final_project_cathypei.pdf)

The rest of the page displays three sets of interactive visualizations that correlate with the data.

```{r eval=TRUE, include=FALSE}

library(tidyverse)
library(tidytext)
library(tm)
library(plotly)
library(widgetframe)
library(tidytext)
library(dplyr)
library(readr)
library(plotly)


# Import the data
wine <- read.csv("data/winemag-data-130k-v2.csv")

# Extract vintage from title using regex, and make a new column for it
wine$vintage <- as.integer(gsub(".*?(\\b\\d{4}\\b).*", "\\1", wine$title))

# Filter out key variables
wine <- wine %>% select(country, description, points, price, vintage, variety, title)

# Create new variable rating
wine$rating <- cut(wine$points, breaks = quantile(wine$points, probs = c(0, 0.33, 0.66, 1)), labels = c("low rating", "median rating", "high rating"), include.lowest = TRUE)

# Create new variable price_cat
wine$price_cat <- cut(wine$price, breaks = quantile(wine$price, probs = c(0, 0.33, 0.66, 1), na.rm = TRUE), labels = c("cheap", "medium", "expensive"), include.lowest = TRUE)

wine$vintage <- as.integer(ifelse(str_detect(wine$title, "\\b20\\d{2}\\b"), 
                                str_extract(wine$title, "\\b20\\d{2}\\b"), 
                                str_extract(wine$title, "\\b\\d{4}\\b")))
```

## Interactive Visualizations {.tabset}

```{r include=FALSE}
# Plotting using plot_ly
scatterplot_3d <- plot_ly(wine, x = ~vintage, y = ~points, z = ~price,
                          type = "scatter3d", mode = "markers",
                          marker = list(size = 5)) %>%
  layout(scene = list(xaxis = list(title = "Vintage"),
                      yaxis = list(title = "Points"),
                      zaxis = list(title = "Price")),
         title = "3D Scatter Plot of Vintage, Points, and Price for Wines")
```

```{r include=FALSE}
country_counts <- wine %>%
    group_by(country) %>%
    summarise(Count = n()) %>%
    ungroup()

# Create a world frequency map
world_map <- plot_geo(country_counts, locations = ~country, z = ~Count, text = ~country,
                      color = ~Count, colors = 'Purples') %>%
    add_trace(
        type = 'choropleth',
        locationmode = 'country names'
    ) %>%
    colorbar(title = "Number of Wine Reviews") %>%
    layout(
        title = "Number of Reviews for Wines Produced in Each Country",
        geo = list(
            showframe = FALSE,
            showcoastlines = TRUE,
            projection = list(type = 'natural earth')
        )
    )

```

```{r include=FALSE, message=FALSE, warning=FALSE}
# Aggregating data and filtering for top 100 grape types by number of reviews
wine_summary <- wine %>%
  group_by(variety) %>%
  summarise(
    NumberOfReviews = n(),
    AveragePrice = mean(price, na.rm = TRUE),
    AveragePoints = mean(points, na.rm = TRUE)
  ) %>%
  arrange(desc(NumberOfReviews)) %>%
  slice_head(n = 100)  # Select top 100 grape types


```


### Figure 1: 3D Scatterplot for Vintage, Points and Price of the Wine

```{r echo=FALSE, message=FALSE, warning=FALSE}
scatterplot_3d
```

### Figure 2: Number of Reviews for Wines Produced in Each Country

```{r echo=FALSE,  message=FALSE, warning=FALSE}
world_map
```

### Figure 3: Bubble Chart of Top 100 Grape types and Their Average Price and Points
```{r  echo=FALSE,  message=FALSE, warning=FALSE}
plot_ly(data = wine_summary, x = ~AveragePrice, y = ~AveragePoints, text = ~variety,
        size = ~NumberOfReviews, color = ~variety,
        sizes = c(20, 50), marker = list(opacity = 0.5)) %>%
  layout(title = 'Bubble Chart of Top 100 Grape Types',
         xaxis = list(title = 'Average Price'),
         yaxis = list(title = 'Average Points'),
         showlegend = TRUE)

```
